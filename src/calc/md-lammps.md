# LAMMPS による MD 計算

## 参考ドキュメント

- LAMMPS 公式サイト  
  - <https://www.lammps.org/>
- LAMMPS 公式ドキュメント（Install）  
  - <https://docs.lammps.org/Install.html>
- ソースコード（GitHub）  
  - <https://github.com/lammps/lammps>

---

## 1. LAMMPS + MD 計算の全体像

### 1.1 MD 計算の基本イメージ

MD 計算では、おおまかに次のステップを繰り返します。

1. 原子の位置・速度をもとに「力」を計算（ポテンシャル）
2. ニュートンの運動方程式にもとづき、位置と速度を更新（時間積分）
3. 必要な物理量（温度・エネルギー・構造など）を記録

LAMMPS はこのループを効率的にまわすための「エンジン」であり、

- 入力スクリプト（テキスト）に
  - 系の定義
  - ポテンシャルの選択
  - 時間積分（どのアンサンブルで回すか）
  - 出力方法（log, dump など）
  を順番に書いていく、というスタイルになっています。

---

### 1.2 LAMMPS 入力スクリプトの主なブロック

LAMMPS の入力ファイル（通常は `.in`）は、だいたい次のブロックに分かれます：

1. 初期設定（units, dimension, atom_style など）
2. 系の定義（格子・ボックス・原子配置）
3. ポテンシャル（pair_style, pair_coeff など）
4. 近接リスト・境界条件（neighbor, neigh_modify, boundary）
5. 初期速度の設定
6. 時間積分（fix nve / nvt / npt など）
7. 出力設定（thermo, dump, restart など）
8. run コマンドによる MD 実行

この「順番」を意識すると、入力を読んだり書いたりするときに迷いにくくなります。

---

## 2. 初期設定：units / dimension / atom_style

### 2.1 units（単位系）

LAMMPS では、`units` コマンドで単位系を選びます。  
例として、金属系 MD でよく使われるのは `metal` 単位系です。

- `metal`：エネルギー [eV], 長さ [Å], 時間 [ps] など
- `real`：生体分子・溶液系でよく使われる単位系
- `si`：SI 単位系 など

#### ポイント：

- 単位系は「ポテンシャルファイルの前提」と揃える必要がある。
- 文献やポテンシャルの説明書きに「LAMMPS metal units」などと書かれていないか確認する。

### 2.2 dimension / boundary / atom_style

- `dimension`：2D / 3D（MD 計算の次元）
- `boundary`：周期境界条件（PBC）か、固定境界か、など
  - 例：金属バルクなら全方向 PBC を使うことが多い
- `atom_style`：原子の情報の持ち方（単純な原子、分子、電荷など）
  - 金属の場合：`atomic`
  - 高分子や分子系：`bond`, `full` など

> 「どんな系を扱いたいか」によって、このあたりの選択が変わる。

---

## 3. 系の定義：ボックスと原子配置

### 3.1 シミュレーションボックスの作り方

系の定義には、大きく次の 2 パターンがあります。

1. LAMMPS のコマンドで格子・ボックス・原子配置を直接生成する
2. 外部ツール（VASP, Materials Project, OVITO, atomsk など）で作成した構造を  
   データファイルとして読み込む

- 内部生成：
  - 単純な結晶格子（bcc, fcc など）をパラメータだけで定義しやすい
- データファイル読み込み：
  - 複雑な構造・多元素・欠陥・表面などを扱うときに便利

### 3.2 data ファイルの役割（概念）

`read_data` コマンドで読み込む data ファイルには、

- 原子数・ボックスサイズ
- 各原子の座標・タイプ
- 必要に応じて、結合情報・角度・電荷 など

が含まれます。

#### 入門のときのポイント：

- 「構造生成」と「MD 本体」を分けて考えると整理しやすい。
- まずは「すでに用意された data ファイル」を使って MD の流れを覚える、というアプローチも有効。

---

## 4. ポテンシャル（力場）の選択と設定

### 4.1 pair_style / pair_coeff の考え方

LAMMPS でのポテンシャルは、

- `pair_style`：どの種類のポテンシャルを使うか（EAM, LJ, ReaxFF など）
- `pair_coeff`：個々の元素ペアに対するパラメータやファイル

で設定します。

例：

- 金属系：`pair_style eam/alloy` ＋ EAM ポテンシャルファイル
- レナード–ジョーンズ：`pair_style lj/cut` ＋ ε, σ の指定
- 反応性ポテンシャル：`pair_style reax/c` ＋ パラメータファイル

### 4.2 ポテンシャル選択時のチェックポイント

- 対象系（金属・イオン・分子など）に適したポテンシャルか
- 文献に「どの LAMMPS ポテンシャルとパラメータを使ったか」が書かれているか
- `units`（単位系）との整合性

> MD の結果の信頼性は、ポテンシャル選択に強く依存するため、  
> 「とりあえず何でもいい」ではなく、文献や公式 examples を参考に選ぶのが重要。

---

## 5. 近接リスト・境界条件

### 5.1 neighbor / neigh_modify

MD では、各原子の近くにいる原子だけを相互作用相手として扱うため、「近接リスト」が必要になります。

- `neighbor`：近接リストのバッファの設定（どれくらい余裕をもたせるか）
- `neigh_modify`：更新頻度などの調整

これらは計算の安定性や速度に効いてくるパラメータで、

- 近すぎると → 頻繁にリスト更新が必要で遅い
- 遠すぎると → 無駄な相互作用を考えすぎて遅い

といったトレードオフがあります。

### 5.2 boundary

- バルク系：全方向を周期境界（PBC）にするのが一般的
- 表面・ナノ粒子系：一部方向を固定境界（`f`）やシュリンクラップ（`s`）にする

---

## 6. 初期速度とアンサンブル（温度・圧力制御）

### 6.1 初期速度（velocity）

- 指定温度に従って速度を割り当てる操作。
- 「系をどの温度からスタートさせるか」を決める段階。

### 6.2 fix コマンドによる時間積分

LAMMPS では、`fix` コマンドで

- 時間積分アルゴリズム
- 温度・圧力制御
- その他の拘束・外場

を指定します。

代表的なもの：

- `fix nve`：エネルギー一定（NVE アンサンブル）  
- `fix nvt`：温度制御（NVT アンサンブル）  
- `fix npt`：温度＋圧力制御（NPT アンサンブル）

#### 典型的な流れのイメージ：

1. `fix nvt` などで、ある温度に「熱平衡化」する
2. 落ち着いたら `fix nve` でエネルギー一定の生の揺らぎを見る
3. あるいは `fix npt` を使って、所望の圧力・体積に落ち着かせる

---

## 7. 出力：エネルギー・構造・統計量

### 7.1 thermo 出力（ログ）

- 温度、全エネルギー、ポテンシャルエネルギー、圧力などを  
  一定ステップごとにログとして出力する設定。
- 何ステップごとに出すか（頻度）は計算負荷にも影響するため、  
  状況に応じて調整する。

### 7.2 dump 出力（構造）

- 原子位置や速度などを「スナップショット」としてファイル出力する。
- OVITO などの可視化ソフトで読み込んで、
  - 結晶構造の変化
  - 欠陥の移動
  - 相転移の様子 など  
  を確認する。

### 7.3 restart ファイル

- 長時間計算を分割して行うときや、
- 条件を変えて追加のシミュレーションを行いたいときに、

途中の状態をファイルに保存しておくもの。

---

## 8. run コマンドとシミュレーション設計

### 8.1 run ステップ数の考え方

`run` で指定するステップ数は、

- タイムステップ（`timestep`）の値
- 観測したい現象の時間スケール

から逆算します。

例（metal 単位系）：

- タイムステップ：1 fs 相当（0.001 ps）
- 走らせたい物理時間：100 ps  
  → 10 万ステップ程度、など

> 初期段階では、「短めにテスト → 異常がないか確認 → 本番時間に延ばす」という流れが安全です。

### 8.2 準備・平衡化・本番の分離

LAMMPS の入力では、

1. エネルギー緩和（最小化）
2. 温度・圧力の平衡化（`fix nvt` / `fix npt`）
3. 本番データ収集（`fix nve` など）

を分けて `run` することが多いです。

- 各フェーズで出力を切り分けておくと、
  - どの段階で何が起きたか
  - 系が平衡に達しているか  
  を判断しやすくなります。

---

## 9. 後処理・解析のイメージ

MD 計算の価値は、得られた

- 構造（軌跡）
- エネルギー
- 応力・圧力
- MSD（平均二乗変位）
- RDF（動径分布関数） など

を解析して、「物理的な解釈」を行うところにあります。

- LAMMPS 内で `compute` や `fix` を使って直接量を計算する方法
- 出力した dump / log を Python などで読み込んで解析する方法

など、いくつかのスタイルがあります。

---

## 10. まとめ

このページでは、「LAMMPS による MD 計算」を組み立てるときの考え方として、

1. 入力スクリプトの主なブロック
   - 初期設定
   - 系の定義
   - ポテンシャル
   - 近接リスト・境界条件
   - 初期速度・アンサンブル
   - 出力設定
   - run
2. ポテンシャル選択と `units` の整合性
3. `fix nve/nvt/npt` によるアンサンブル制御
4. thermo / dump / restart によるログ・構造・再開
5. 平衡化と本番 run を分けて設計する考え方

を整理しました。