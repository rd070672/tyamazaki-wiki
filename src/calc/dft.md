# 密度汎関数理論（DFT）の基礎

密度汎関数理論（Density Functional Theory; DFT）は、多電子系の基底状態の性質が電子密度 $n(\mathbf{r})$ の汎関数として記述できるという定理に基づき、物質の電子状態と多様な物性を第一原理から計算する枠組みである。実際の計算ではコーン–シャム（Kohn–Sham）形式により、相互作用する多電子問題を、密度に依存する有効一電子方程式の自己無撞着解として扱う。


### 参考ドキュメント
1. P. Hohenberg and W. Kohn, Inhomogeneous Electron Gas, Physical Review 136, B864 (1964).   
  https://link.aps.org/doi/10.1103/PhysRev.136.B864
2. W. Kohn and L. J. Sham, Self-Consistent Equations Including Exchange and Correlation Effects, Physical Review 140, A1133 (1965).   
  https://link.aps.org/doi/10.1103/PhysRev.140.A1133
3. 志賀基之, 密度汎関数理論, 分子シミュレーション学会誌「アンサンブル」21(4) (2019).   
  https://www.jstage.jst.go.jp/article/mssj/21/4/21_277/_pdf/-char/ja

## 1. DFTの目的と理論的位置づけ

量子多体系の厳密な基底状態は、$N$ 電子の波動関数 $\Psi(\mathbf{r}_1,\ldots,\mathbf{r}_N)$ に従うシュレーディンガー方程式の解として与えられる。しかし、$\Psi$ は $3N$ 次元の自由度を持つため、電子数が増えるほど直接解法は急速に困難になる。

DFTの中心的な発想は、波動関数そのものではなく、3次元関数である電子密度
$$
n(\mathbf{r})
= N \int |\Psi(\mathbf{r},\mathbf{r}_2,\ldots,\mathbf{r}_N)|^2 \, d\mathbf{r}_2\cdots d\mathbf{r}_N
$$
を基本変数として採用する点にある。電子密度は観測可能量であり、構造最適化や応力、磁性、分極など多くの物性評価に直接関わる。DFTは「電子密度を入力として、基底状態のエネルギーと密度を自己無撞着に決める」ための一般理論である。


## 2. ホーエンベルク–コーンの定理（Hohenberg–Kohn定理）

外部ポテンシャル $v_{\mathrm{ext}}(\mathbf{r})$（固体では原子核・イオンが作るポテンシャル）下の相互作用電子系を考える。電子ハミルトニアンは（原子単位系を用いれば）
$$
\hat{H} = \hat{T} + \hat{V}_{\mathrm{ee}} + \int v_{\mathrm{ext}}(\mathbf{r}) \hat{n}(\mathbf{r})\, d\mathbf{r}
$$
である。ここで $\hat{T}$ は運動エネルギー、$\hat{V}_{\mathrm{ee}}$ は電子間相互作用、$\hat{n}(\mathbf{r})$ は密度演算子である。

### 2.1 第1定理：密度と外部ポテンシャルの一意対応
基底状態が非縮退であるという条件の下で、基底状態密度 $n_0(\mathbf{r})$ は外部ポテンシャル $v_{\mathrm{ext}}(\mathbf{r})$（定数分の不定性を除く）を一意に決める。したがって、密度 $n(\mathbf{r})$ が与えられれば、ハミルトニアンが定まり、基底状態波動関数や全エネルギーなどあらゆる基底状態量は $n(\mathbf{r})$ の汎関数として定まる。

### 2.2 第2定理：変分原理
ある密度 $n(\mathbf{r})$ に対してエネルギー汎関数 $E[n]$ を定義でき、真の基底状態密度 $n_0(\mathbf{r})$ は $E[n]$ を最小化する：
$$
E[n] \ge E[n_0] = E_0.
$$
この変分原理により、適切な汎関数が分かれば、密度を変分して基底状態を得られる。

ただし、HK定理は「普遍汎関数の存在」を保証するが、その具体形（とくに電子相関を含む項）は一般には未知である。この未知性が、交換相関（exchange-correlation; xc）汎関数近似の主戦場となる。


## 3. コーン–シャム形式：有効一電子方程式への写像

HK定理だけでは、実際に $E[n]$ を評価して最小化する具体手段が不足する。コーン–シャムは、相互作用系を「同じ密度を与える非相互作用系」へ写像し、未知の困難を交換相関項に押し込めることで実用計算を可能にした。

### 3.1 エネルギー汎関数の分解
全エネルギー汎関数を
$$
E[n] = T_s[n] + \int v_{\mathrm{ext}}(\mathbf{r}) n(\mathbf{r})\, d\mathbf{r}
+ E_{\mathrm{H}}[n] + E_{\mathrm{xc}}[n] + E_{\mathrm{II}}
$$
と分解する。ここで

- $T_s[n]$：同じ密度 $n(\mathbf{r})$ を持つ非相互作用電子の運動エネルギー
- $E_{\mathrm{H}}[n]$：古典的クーロン（ハートリー）項  
  $$
  E_{\mathrm{H}}[n] = \frac12 \int \int \frac{n(\mathbf{r})n(\mathbf{r'})}{|\mathbf{r}-\mathbf{r'}|}\, d\mathbf{r}\, d\mathbf{r'}
  $$
- $E_{\mathrm{xc}}[n]$：交換と相関、ならびに $T - T_s$ など残余をすべて含む項
- $E_{\mathrm{II}}$：イオン間反発（周期系ではエワルド和などで評価される）

である。未知の本質は $E_{\mathrm{xc}}[n]$ に集約される。

### 3.2 コーン–シャム方程式
軌道 $\{\phi_i(\mathbf{r})\}$ と占有数 $\{f_i\}$ により密度を
$$
n(\mathbf{r}) = \sum_i f_i |\phi_i(\mathbf{r})|^2
$$
と表すと、変分原理から次の有効一電子方程式が得られる：
$$
\left[
-\frac12 \nabla^2 + v_{\mathrm{ext}}(\mathbf{r}) + v_{\mathrm{H}}[n](\mathbf{r}) + v_{\mathrm{xc}}[n](\mathbf{r})
\right]\phi_i(\mathbf{r})
= \varepsilon_i \phi_i(\mathbf{r}).
$$
ここで
$$
v_{\mathrm{H}}[n](\mathbf{r}) = \int \frac{n(\mathbf{r'})}{|\mathbf{r}-\mathbf{r'}|}\, d\mathbf{r'},\qquad
v_{\mathrm{xc}}[n](\mathbf{r}) = \frac{\delta E_{\mathrm{xc}}[n]}{\delta n(\mathbf{r})}
$$
である。$v_{\mathrm{xc}}$ が密度依存であるため、方程式は自己無撞着（self-consistent）に解かれる。

### 3.3 自己無撞着の論理構造
計算は次の論理循環を収束させることで進む：

1. 初期密度 $n^{(0)}(\mathbf{r})$ を与える  
2. $n^{(k)}$ から有効ポテンシャル $v_{\mathrm{eff}}^{(k)} = v_{\mathrm{ext}} + v_{\mathrm{H}}[n^{(k)}] + v_{\mathrm{xc}}[n^{(k)}]$ を作る  
3. コーン–シャム方程式を解き、軌道 $\phi_i^{(k)}$ と固有値 $\varepsilon_i^{(k)}$ を得る  
4. 新しい密度 $n^{(k+1)}(\mathbf{r})$ を組み立てる  
5. $n^{(k+1)}$ と $n^{(k)}$ が一致するまで反復する  

この反復の安定化には密度混合（mixing）や占有の扱い（スメアリング）が本質的に関わる。

## 4. 交換相関汎関数：近似階層と物理的含意

交換相関汎関数は、電子間の量子力学的交換（パウリ原理に由来）と相関（クーロン反発と運動の相関）を同時に含む。厳密形は不明であり、実際のDFTの信頼性・限界は $E_{\mathrm{xc}}$ の選択に強く依存する。

### 4.1 LDA（局所密度近似）
局所的に一様電子気体（uniform electron gas）の結果を適用し、
$$
E_{\mathrm{xc}}^{\mathrm{LDA}}[n] = \int n(\mathbf{r})\, \varepsilon_{\mathrm{xc}}(n(\mathbf{r}))\, d\mathbf{r}
$$
とする。固体の格子定数や凝集エネルギーで過結合（結合が強めに出る）傾向を持つことが多い一方、金属や密度が比較的滑らかな系では基本として良い出発点となる場合がある。

### 4.2 GGA（一般化勾配近似）
密度勾配 $\nabla n$ を取り込み、
$$
E_{\mathrm{xc}}^{\mathrm{GGA}}[n] = \int f(n(\mathbf{r}),\nabla n(\mathbf{r}))\, d\mathbf{r}
$$
とする。PBEは材料科学で広く用いられる代表例である。結合距離・格子定数の改善が期待できる一方、バンドギャップ過小評価や弱い分散相互作用の不足など、根本的限界は残る。

### 4.3 meta-GGA
GGAに加え、軌道運動エネルギー密度
$$
\tau(\mathbf{r}) = \frac12\sum_i f_i |\nabla \phi_i(\mathbf{r})|^2
$$
などを導入し、局所環境の識別能力を高める。SCANは制約条件を満たす非経験的meta-GGAの代表であり、格子定数や凝集エネルギー、弱い相互作用などで改善が報告されている。

### 4.4 ハイブリッド汎関数
交換相関の交換部分にハートリー–フォック（HF）交換を混合する：
$$
E_x^{\mathrm{hyb}} = a E_x^{\mathrm{HF}} + (1-a)E_x^{\mathrm{DFT}},
\qquad E_{\mathrm{xc}}^{\mathrm{hyb}} = E_x^{\mathrm{hyb}} + E_c^{\mathrm{DFT}}.
$$
HSEは遮蔽クーロンを用いることで周期固体系の計算負荷を抑え、半導体・絶縁体のバンドギャップや欠陥準位の改善に有効であることが多い。ただし計算費用はセミローカル汎関数より大きい。

### 4.5 分散相互作用（van der Waals）の補正
LDA/GGA/meta-GGAは長距離分散力を十分に表現できない場合がある。補正の考え方は大別して次の二系統である。

- 非局所相関を汎関数形に組み込む（vdW-DFなど）  
- 原子対相互作用として付加する（DFT-D3など）

## 5. スピンDFTとスピン軌道相互作用

### 5.1 スピン分極（collinear）
スピンアップ・ダウン密度 $n_\uparrow(\mathbf{r}), n_\downarrow(\mathbf{r})$ を独立変数とし、
$$
n(\mathbf{r}) = n_\uparrow(\mathbf{r}) + n_\downarrow(\mathbf{r}),\quad
m(\mathbf{r}) = n_\uparrow(\mathbf{r}) - n_\downarrow(\mathbf{r})
$$
を導入する。交換相関汎関数は $E_{\mathrm{xc}}[n_\uparrow,n_\downarrow]$ として与えられ、磁性体の基底状態（強磁性・反強磁性など）の比較が可能となる。

### 5.2 非共線と磁化ベクトル
磁化密度をベクトル $\mathbf{m}(\mathbf{r})$ として扱い、スピンが空間的に回転するスピンテクスチャやスキルミオン、弱強磁性などの非共線（noncollinear）の記述に用いる。この場合、コーン–シャム軌道は二成分スピノルとなる。

### 5.3 スピン軌道相互作用（SOC）
相対論効果としてSOCを取り込むと、磁気異方性、軌道磁気モーメント、Dzyaloshinskii–Moriya相互作用などが現れる。実装は、PAWや全電子法ではスピノルKS方程式として扱うことが多い。SOCはエネルギー差（磁気異方性エネルギーなど）が微小になりやすく、収束設定や$k$点密度の要求が厳しくなることが多い。


## 6. 数値表現：基底関数と原子核近傍の扱い

DFTの理論式は連続空間上の偏微分方程式であり、計算では有限個の自由度へ離散化する必要がある。そこで重要なのが基底関数と、原子核近傍（急峻なポテンシャル）をどう扱うかである。

### 6.1 基底関数の選択
- 平面波基底：周期固体に適合し、収束性が単純（カットオフエネルギーで制御）である。擬ポテンシャルやPAWと組み合わせるのが基本である。
- 局在基底（原子軌道、ガウシアン、数値原子軌道）：分子や局在系で効率的になり得る。基底重なりや基底不完全性の扱いが重要となる。
- 全電子法（LAPW/APW+loなど）：核近傍の急峻さを直接扱い、高精度が期待できるが計算は重くなりやすい。

### 6.2 擬ポテンシャルとPAW
原子核近傍での価電子波動関数の振動を緩和し、平面波展開を現実的にする考え方が擬ポテンシャルである。PAW法は、擬ポテンシャル法と全電子精度を架橋する一般化として構成され、現代の周期DFT実装の重要要素である。


## 7. 周期系の取り扱い：ブロッホ状態と$k$点積分

周期固体ではブロッホの定理により
$$
\phi_{n\mathbf{k}}(\mathbf{r}) = e^{i\mathbf{k}\cdot\mathbf{r}} u_{n\mathbf{k}}(\mathbf{r})
$$
と表される。全エネルギーや電子数はブリルアンゾーンでの積分
$$
\int_{\mathrm{BZ}} (\cdots)\, d\mathbf{k}
$$
として現れ、数値的には有限個の$k$点サンプリング（Monkhorst–Packなど）で近似する。

金属ではフェルミ面近傍の占有が不連続となり収束が遅くなるため、占有数を温度で丸めるスメアリングが用いられる。絶縁体・半導体ではガンマ点中心の比較的粗いメッシュでも収束しやすいことがあるが、精密な応力やフォノン、磁気異方性などでは高密度$k$点が必要になる場合がある。


## 8. 構造・応力・力：DFTが与える力学量

### 8.1 ヘルマン–ファインマン力基底依存項
全エネルギー $E$ から原子座標 $\mathbf{R}_I$ に関する力は
$$
\mathbf{F}_I = -\frac{\partial E}{\partial \mathbf{R}_I}
$$
で定義される。厳密解に対してはヘルマン–ファインマン力（Hellmann–Feynman）が成立するが、離散化基底が原子位置に依存する場合にはプルアイ力（Pulay force）等が現れる。平面波基底は基底が原子位置に依存しないため、概念上はこの点が単純である（ただしPAWや擬ポテンシャルの寄与は含めて評価される）。

### 8.2 応力と格子最適化
セル変形に対するエネルギー微分から応力テンソル $\sigma_{\alpha\beta}$ が得られる：
$$
\sigma_{\alpha\beta} = \frac{1}{\Omega}\frac{\partial E}{\partial \epsilon_{\alpha\beta}},
$$
ここで $\Omega$ は体積、$\epsilon_{\alpha\beta}$ はひずみテンソルである。格子定数や弾性定数は、エネルギー–ひずみ関係のフィッティング、もしくは線形応答の枠組み（DFPTなど）で評価される。


## 9. 電子状態量

### 9.1 バンド構造と状態密度
コーン–シャム固有値 $\varepsilon_{n\mathbf{k}}$ は、励起エネルギーの厳密値ではないが、バンド構造の定性的理解や比較に広く用いられる。状態密度（DOS）は
$$
D(E) = \sum_{n\mathbf{k}} \delta(E - \varepsilon_{n\mathbf{k}})
$$
として定義され、数値的にはガウシアン等で平滑化される。

### 9.2 電荷解析
電子密度分布から、原子への電荷分割（Bader、Mulliken、Hirshfeldなど）や結合の指標（電子局在関数ELFなど）を計算できる。ただし電荷分割は一意ではなく、手法依存性を伴うため、解釈では物理量の定義と限界を明示することが重要である。

## 10. 強相関・局在電子への拡張：DFT+Uなど

遷移金属酸化物や希土類化合物などでは、局在$d/f$電子の相関が強く、GGA等のセミローカル汎関数では誤った金属化や磁性評価になる場合がある。DFT+Uは局在軌道に対してハバード型の補正を加える：
$$
E^{\mathrm{DFT+U}} = E^{\mathrm{DFT}} + E_U - E_{\mathrm{dc}}
$$
ここで $E_{\mathrm{dc}}$ は二重計数補正である。実装の基本として、$U_{\mathrm{eff}} = U - J$ の形で扱う簡略化（Dudarev形式）が広く使われる。$U$ の決定には実験整合、線形応答、あるいはより高次の理論との整合が用いられる。


## 11. 温度の導入：有限温度DFT

有限温度では、エネルギー最小化ではなく自由エネルギー最小化が自然となる。Merminの有限温度DFT（Merminの定式化）では、温度 $T$ と化学ポテンシャルの下で密度が平衡状態を一意に定めることが示され、自由エネルギー汎関数の変分として定式化される。固体DFTの数値実装で用いられるスメアリングは、金属の占有の丸めとして有限温度の形式と整合的に理解できる側面を持つ（ただし目的は数値安定化であり、物理温度の再現と一致しない設定もあり得る）。


## 12. 近似の性質と誤差の構造

DFTは「理論としては厳密であるが、交換相関汎関数を近似する」という二重性を持つ。したがって、誤差は主に次の要因から生じる。

- 交換相関近似の系統誤差（自己相互作用誤差、分散相互作用の不足、バンドギャップ過小評価など）
- 離散化誤差（基底の不完全性、平面波カットオフ、実空間グリッドなど）
- ブリルアンゾーン積分誤差（$k$点不足、スメアリング設定）
- 構造探索の問題（局所極小、磁気秩序の取り違え、初期条件依存）
- 擬ポテンシャル/PAWデータセットの選択（価電子の取り方、半芯状態、相対論効果の取り込み）

これらは互いに独立ではなく、例えばSOCや磁気異方性のような微小エネルギー差では、複数の誤差源が同程度の大きさになり得る。そのため、収束性の吟味と比較基準（汎関数やデータセットの一貫性）を重視する必要がある。


## 13. 手法選択の指針

### 13.1 交換相関近似の比較
| 近似 | 入力依存性 | 長所 | 注意すべき点 | 計算負荷 |
|---|---|---|---|---|
| LDA | $n$ | 金属・密度が滑らかな系で安定に動くことが多い | 結合が強め、格子定数が小さめに出る傾向が現れ得る | 小 |
| GGA（例：PBE） | $n,\nabla n$ | 化学結合・格子定数の改善が期待できる | 分散力やギャップ、自己相互作用誤差が残る | 小〜中 |
| meta-GGA（例：SCAN） | $n,\nabla n,\tau$ 等 | 多様な結合様式への適応性が向上し得る | 実装・収束が難しくなる場合がある | 中 |
| ハイブリッド（例：HSE） | 非局所交換 | バンドギャップ、欠陥準位、交換相互作用の改善が期待できる | 計算費用が増大し、系サイズや$k$点に制約 | 大 |

### 13.2 原子核近傍の扱いと基底
| 方法 | 価電子の扱い | 特徴 | 注意すべき点 |
|---|---|---|---|
| 擬ポテンシャル | 核・芯電子を有効化 | 平面波で効率的 | データセット依存性が出る |
| PAW | 全電子情報を再構成 | 擬ポテンシャルの効率と全電子精度の橋渡し | 半芯状態やSOC設定の整合が重要 |
| 全電子（LAPW等） | 全電子を直接 | 高精度が期待できる | 計算費用・設定が重い |

### 13.3 金属の占有丸め
| 方法 | 代表例 | 特徴 | 使い分けの考え方 |
|---|---|---|---|
| フェルミ–ディラック | 物理温度に対応 | 物理的解釈が明快 | 有限温度物性を扱う場合に整合的 |
| ガウシアン | 数値安定化 | DOSが滑らかになりやすい | 収束促進に使われることが多い |
| Methfessel–Paxton | 高次補正 | エネルギー収束が速い場合がある | 残差の扱いと整合が必要 |
| テトラヘドロン | 0 K積分近似 | 絶縁体・半導体で有効 | 金属では工夫が必要 |


## 14. 計算条件

DFT結果は、近似選択と数値設定に依存するため、第三者が同等条件で再計算できるよう、少なくとも次を明示することが望ましい。

- 使用した交換相関汎関数名（LDA/GGA/meta-GGA/ハイブリッド、必要ならパラメータ）
- 擬ポテンシャル/PAW/全電子法の別、データセットの種類と版情報
- 平面波カットオフ（または基底セット仕様）
- $k$点メッシュ（およびガンマ点中心か否か）、スメアリング方式と幅
- スピン設定（非磁性/スピン分極/非共線）、SOCの有無
- DFT+U等の補正の有無と $U,J$ の値、対象軌道
- 構造最適化の収束条件（力・応力・エネルギー基準）と最終構造
- エネルギー差が論点の場合、差分の定義（基準構造・基準磁気秩序・基準セルなど）


## まとめと展望

DFTは、HK定理が保証する「密度が基底状態物性を定める」という原理を、コーン–シャム形式によって実用計算へ接続した理論である。未知の交換相関汎関数を近似することで、構造・エネルギー・磁性・応力といった多くの量を、系の原子配置と電子数から一貫して求めることができる。

一方で、交換相関近似の系統誤差、分散相互作用や強相関の取り扱い、コーン–シャム固有値の解釈、微小エネルギー差の数値収束など、理論的・数値的な限界も明確である。今後は、制約条件に基づく汎関数設計（meta-GGAやその先）、非局所相関の洗練、GW/DMFT/TDDFTなど他理論との結合、ならびに高精度参照データと計算資源の進展により、DFTが扱える現象範囲と定量性がさらに拡大していくと期待される。

### 参考文献
- J. P. Perdew, K. Burke, and M. Ernzerhof, Generalized Gradient Approximation Made Simple, Phys. Rev. Lett. 77, 3865 (1996).   
  https://link.aps.org/doi/10.1103/PhysRevLett.77.3865
- J. Sun, A. Ruzsinszky, and J. P. Perdew, SCAN meta-GGA, Phys. Rev. Lett. 115, 036402 (2015).  
  https://link.aps.org/doi/10.1103/PhysRevLett.115.036402
- P. E. Blöchl, Projector augmented-wave method, Phys. Rev. B 50, 17953 (1994).  
  https://link.aps.org/doi/10.1103/PhysRevB.50.17953
- S. L. Dudarev et al., LDA+U（簡略回転不変形式に関連）, Phys. Rev. B 57, 1505 (1998).  
  https://link.aps.org/doi/10.1103/PhysRevB.57.1505
- M. Dion et al., Van der Waals Density Functional for General Geometries, Phys. Rev. Lett. 92, 246401 (2004).  
  https://link.aps.org/doi/10.1103/PhysRevLett.92.246401
- S. Grimme et al., DFT-D3（分散補正の系統）, J. Chem. Phys. 132, 154104 (2010).  
  https://pubs.aip.org/aip/jcp/article/132/15/154104/926936/
- N. D. Mermin, Thermal Properties of the Inhomogeneous Electron Gas（有限温度DFT）, Phys. Rev. 137, A1441 (1965).  
  https://link.aps.org/doi/10.1103/PhysRev.137.A1441
- 樋口克彦, 密度汎関数理論の発展, 日本物理学会誌 67(8) (2012).  
  https://www.jstage.jst.go.jp/article/butsuri/67/8/67_KJ00008160775/_pdf
- RIKEN 常田グループ資料：密度汎関数法の基礎（講義資料）  
  https://www2.riken.jp/qcl/members/tsuneda/web/dft05-sec1.pdf
- 東京大学 物性研究所 講義ノート（半導体講義内のKS方程式解説）  
  https://note-collection.issp.u-tokyo.ac.jp/katsumoto/semicon2021/note1-14_jp.pdf