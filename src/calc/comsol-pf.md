# COMSOL を用いた相変態解析
作成日：2025年11月23日

## 概要
- COMSOL Multiphysics では、**相変態（固相／液相、析出、スピノーダル分解、マルテンサイト変態など）** を
  - **フェーズフィールド法（Phase Field）**
  - **汎用 PDE（General Form / Coefficient Form PDE）**
  - **Heat Transfer（熱伝導）や Solid Mechanics（弾性場）との連成**
  を組み合わせることで解析できる。
- 基本的な考え方：
  - 秩序パラメータ（オーダーパラメータ）$\phi$ や濃度 $c$ を **連続場** として扱う。
  - 自由エネルギー汎関数 $F[\phi,c,T,\varepsilon]$ を定義し、
  - その変分から得られる **時間発展方程式（Allen–Cahn, Cahn–Hilliard など）** を COMSOL の PDE として実装する。
  - 必要に応じて、熱伝導・弾性場・電磁場などと連成させる。

## COMSOL における典型的な相変態モデル
- **フェーズフィールドモデル（Phase Field）**
  - 秩序パラメータ：$\phi(\mathbf{x},t)$（例：0＝相A、1＝相B）
  - 濃度場：$c(\mathbf{x},t)$（合金系、析出・スピノーダル分解など）
  - 温度場：$T(\mathbf{x},t)$
- **熱移動との連成**
  - Heat Transfer in Solids などを用いて、潜熱・温度依存の自由エネルギーを表現。
  - 凝固・融解、溶接、レーザ加熱などの **温度駆動相変態** が対象。
- **弾性場との連成**
  - Solid Mechanics で変位 $\mathbf{u}$・ひずみ $\varepsilon_{ij}$ を解き、
  - 格子ミスマッチや体積膨張を「固有ひずみ」として相変態に組み込む。
  - マルテンサイト変態、析出による内部応力などが対象。

## フェーズフィールドモデルの基本式
- 自由エネルギー密度の典型例：
  $$
    f(\phi, c, T, \nabla\phi)
      = f_\text{bulk}(\phi,c,T)
        + \frac{\kappa}{2}|\nabla\phi|^2
  $$
  - $f_\text{bulk}$：二重井戸ポテンシャル（2つの安定相）や混合自由エネルギー
  - $\kappa$：界面エネルギーに対応する係数
- **Allen–Cahn 型（秩序パラメータの緩和）**
  $$
    \frac{\partial\phi}{\partial t}
      = -L \frac{\delta F}{\delta \phi}
      = -L\left(\frac{\partial f}{\partial\phi}
                -\kappa\nabla^2\phi\right)
  $$
  - 拡散を伴わない非保存量（例：マルテンサイト、秩序–無秩序変態）に適用。
- **Cahn–Hilliard 型（濃度場の拡散）**
  $$
    \frac{\partial c}{\partial t}
      = \nabla\cdot\left( M\nabla\mu \right),\quad
      \mu = \frac{\delta F}{\delta c}
  $$
  - 濃度保存を伴う相分離やスピノーダル分解、析出に適用。

## COMSOL での設定フロー（概念）

1. **モデル・ジオメトリの作成**
   - 2D / 3D モデルを選択し、粒子・薄膜・棒・バルクなど解析対象の形状を作成。
   - メッシュは **界面幅・拡散長** を解像できる程度に細かくする。

2. **パラメータ・自由エネルギーの定義**
   - Parameters で、$\kappa, L, M, W, a, T_c$ などの材料定数・モデルパラメータを定義。
   - Variables や Component Couplings で、  
     - $f_\text{bulk}(\phi,c,T)$  
     - $\mu = \partial f / \partial c - \kappa_c\nabla^2 c$  
     など、自由エネルギー密度や化学ポテンシャルを式として記述。

3. **PDE インターフェースの追加**
   - Mathematics → **General Form PDE** / **Coefficient Form PDE** を利用して、
     - 秩序パラメータ $\phi$ 用 PDE（Allen–Cahn 型）
     - 濃度 $c$ 用 PDE（Cahn–Hilliard 型）
     を実装する。
   - それぞれに対し、
     - 時間微分項（`d*u/dt`）
     - 拡散項（`∇·(M∇µ)`など）
     - 反応項（`-L∂f/∂φ` など）
     を COMSOL の式で設定する。

4. **熱伝導・弾性場との連成（必要に応じて）**
   - Heat Transfer in Solids：
     - 温度 $T$ の時間発展を解き、自由エネルギーの温度依存や潜熱項に反映。
   - Solid Mechanics：
     - 相変態による「固有ひずみ」や、  
       相によって異なる弾性定数を設定し、内部応力と相変態の双方向連成を表現。

5. **初期条件・境界条件**
   - 初期条件：
     - 均一相＋微小ノイズ（スピノーダル分解）
     - 部分的な相核（核生成–成長）
   - 境界条件：
     - 通常はフラックスゼロ（$\nabla\phi\cdot\mathbf{n}=0$、$\nabla\mu\cdot\mathbf{n}=0$）が多い。
     - 外界との濃度・温度交換を考える場合は Dirichlet / Robin 条件も設定。

6. **Time Dependent スタディの実行**
   - 時間範囲：相変態時間スケール（µs〜s など）を考慮して設定。
   - 時間ステップ上限を少し小さめに指定し、非線形ソルバの収束を確認しながら解析。

7. **ポストプロセス**
   - $\phi$ や $c$ の分布を、等高線・表面プロット・ボリュームプロットとして表示。
   - 相分率の時間変化、平均濃度、自由エネルギーの時間変化を 1D プロットで確認。
   - 粒径分布や相境界面積などを評価（Integration / Derived Values を利用）。

## 代表的な応用例

- **二相合金のスピノーダル分解**
  - 初期均一濃度＋微小ノイズから、時間とともに周期構造が発達する過程を解析。
- **析出強化合金の析出成長**
  - 過飽和固溶体からの析出粒子の核生成・成長・粗大化のシミュレーション。
- **固液相変態（凝固・融解）**
  - 温度場との連成により、界面の移動・デンドライト成長などをモデル化。
- **マルテンサイト変態・構造相変態**
  - 秩序パラメータ＋弾性場連成により、  
    変態による内部応力・変形パターンを評価（フェーズフィールド＋弾性場）。

## 実務的な注意点

- **メッシュと界面幅**
  - 界面幅をメッシュで 4〜8 要素程度は解像するように設計すると、  
    数値安定性と精度のバランスが取りやすい。
- **時間刻みと安定性**
  - 拡散・反応の時間スケールに応じて、時間刻みを小さくする必要がある。
  - 時間刻みが粗すぎると、界面の振動・非物理的なオーバーシュートが起こりうる。
- **自由エネルギーモデルの妥当性**
  - 実際の合金系に対応させるには、CALPHAD や第一原理計算・実験から得られた  
    熱力学データをもとに $f(c,T)$ を構築することが望ましい。
- **マルチフィジックス連成による計算負荷**
  - 相変態＋熱伝導＋弾性＋電磁場などの同時連成は計算コストが高くなる。
  - 目的に応じて必要な物理だけを残した簡略モデルから始めると扱いやすい。

