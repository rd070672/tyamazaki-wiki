# CALPHAD（計算状態図）法

CALPHADとは、各相のギブス自由エネルギーを温度・圧力・組成の関数としてモデル化し、全ギブスエネルギー最小化から相平衡や状態図を計算する枠組みである。状態図計算に加え、熱力学パラメータの評価（assessment）とデータベース化までを含む方法論である。

## 参考ドキュメント
- 大沼郁雄, 計算状態図（CALPHAD）の進展と軽金属への応用, 軽金属 69(7) (2019)（PDF）
  https://www.jstage.jst.go.jp/article/jilm/69/7/69_690703/_pdf
- Thermo-Calc：理論（日本語）CALPHADの概要と溶体モデルの説明
  https://www.engineering-eye.com/THERMOCALC/details/theory.html
- U. R. Kattner, The CALPHAD Method and its Role in Materials Design (2016)（概説）
  https://pmc.ncbi.nlm.nih.gov/articles/PMC4912057/


## 1. CALPHADで何をするのか（全体像）
CALPHADの中心は「相ごとの熱力学モデル」と「平衡計算」である。

- 相ごとのモデル化：各相 α のモルギブスエネルギー $G_m^{\alpha}(T,P,\{x_i\})$ を表す
- 平衡計算：候補相の総ギブスエネルギー $G_{\mathrm{tot}}$ を最小化し、平衡相・相分率・組成を得る
- データベース：モデル式のパラメータ（相互作用パラメータ等）を蓄積し、他系へ外挿できるようにする

平衡の考え方
$$
G_{\mathrm{tot}}=\sum_{\alpha} n^{\alpha} G_m^{\alpha}(T,P,\{x_i^{\alpha}\})
$$
制約（質量保存、相分率の制約）下で $G_{\mathrm{tot}}$ を最小化して平衡を求める。

## 2. 典型的なギブスエネルギー表式（置換型溶体の例）
置換型溶体相（例：FCC, BCC）の基本分解は次である。
$$
G_m = G_m^{\mathrm{ref}} + G_m^{\mathrm{id}} + G_m^{\mathrm{ex}} + G_m^{\mathrm{phys}}
$$

(1) 参照項（純物質・格子安定性など）
- 純元素の基準状態と、相の基準（lattice stability）に依存する

(2) 理想混合項
$$
G_m^{\mathrm{id}} = RT\sum_i x_i \ln x_i
$$

(3) 過剰項（相互作用）
二元系 A–B の代表例（Redlich–Kister 型）
$$
G_m^{\mathrm{ex}} = x_A x_B \sum_{k=0}^{K} L_{AB}^{(k)}(T)\,(x_A-x_B)^k
$$
ここで $L_{AB}^{(k)}(T)$ は温度依存の相互作用パラメータであり、実験・第一原理・推算などにより同定される。

(4) 物理寄与
- 強磁性相の磁気寄与、圧力に対する体積寄与、短距離秩序の寄与などを状況に応じて加える

## 3. 副格子モデルとCEF（化合物・規則相・侵入型固溶体）
規則相や化合物相、侵入型固溶体（例：炭化物、窒化物、B2/L1_2 など）は、副格子（sublattice）上の占有率で表すことが多い。
- 組成 $x_i$ ではなく、各副格子 s の site fraction $y_i^{(s)}$ を状態変数にする

概念式（相 α）
$$
G_m^{\alpha} = \sum_{\mathrm{endmembers}} \left(\prod_s y_{i_s}^{(s)}\right) G_{\mathrm{endmember}}(T)
+ RT \sum_s a^{(s)} \sum_i y_i^{(s)}\ln y_i^{(s)} + G^{\mathrm{ex}}(\{y\})
$$
ここで CEF（compound energy formalism）は「副格子を持つ相の自由エネルギーを、エンドメンバー（端成分）状態の線形結合＋混合項＋相互作用で表す」ための標準的枠組みである。

## 4. 熱力学データベース（TDB）とアセスメント
CALPHADの実務は「データベース（TDB）を使う」か「TDBを作る/改善する」で決まる。

- 熱力学パラメータ：$L_{AB}^{(k)}(T)$ やエンドメンバー自由エネルギー係数など
- アセスメント：平衡状態図、活量、比熱、混合熱、相境界など多様なデータに同時に整合するようパラメータを推定する
- 近年の流れ：第一原理計算の熱力学量を取り込む“第三世代”データベースの整備、相場（phase-field）や速度論への展開である

TDBの読み方のポイント（学生向け）
- 対応元素・相リスト、適用温度範囲、準安定相の扱いを最初に確認する
- データベース間で相名・モデル（副格子定義）が異なることがあるため、混在に注意する

## 5. CALPHADでよく行う計算（材料設計での使い所）
| 計算 | 出力 | 材料研究での使い所 |
|---|---|---|
| 平衡計算 | 平衡相、相分率、各相組成 | 析出相の安定性、溶解度、脆化相回避 |
| 状態図（T-x, x-x, 擬二元など） | 相境界、共晶/包晶など | 合金設計、熱処理窓の見積り |
| 活量・化学ポテンシャル | $\mu_i$, 活量 $a_i$ | 酸化・窒化、拡散駆動力、界面反応 |
| 駆動力（driving force） | $\Delta G$ | 核生成・相変態の起点評価 |
| Scheil凝固（近似） | 偏析、終液組成 | 鋳造・AMの偏析/割れ感度の一次評価 |

## 6. 速度論への拡張（拡散・析出・組織）
CALPHADは平衡が基本であるが、移動度（mobility）データベースと組み合わせることで拡散律速現象を扱う枠組みが整備されている。
- 例：DICTRAは多成分拡散方程式を数値的に解き、CALPHAD熱力学と一体で拡散変態を扱うための代表的モジュールである
- 析出（核生成・成長）や相場シミュレーションへの連成も、CALPHADの応用として定着している

## 7. マテリアルズ・インフォマティクス（MI）との接続
CALPHADは「物理に基づく生成器（データ生成と制約）」としてMIに組み込みやすい。

代表的な接続パターン
- 擬似データ生成：広い組成空間の相分率や安定相を高速生成し、MLの教師データやフィルタにする
- ハイブリッド最適化：サロゲートモデル＋CALPHAD制約（例：有害相が出ない領域のみ探索）
- 不確かさの扱い：CALPHADパラメータの不確かさを推定し、相境界や特性の信頼区間を付ける（ベイズ的UQなど）

## 8. よくある落とし穴
- データベースの適用範囲外（温度・組成・相）が混じると、結果はもっともらしく見えても信頼できない
- 相選択が重要である：候補相を入れ忘れると誤った“平衡”になる
- 準安定相の扱い：あえて除外する計算（擬平衡）と、現実の加工プロセスの整合を意識する
- 圧力効果：体積データを無視する近似は多いが、高圧条件では影響が出る場合がある

## 9. ワークフロー
1. 目的を決める：平衡相か、溶解度か、凝固偏析か、駆動力かを明確化する  
2. 適切なDBを選ぶ：対象材料系・温度域・相の網羅性を確認する  
3. 成分と相を定義する：含有元素、候補相（液相、母相、析出相等）を列挙する  
4. 条件を設定する：$T, P$、総組成、固定する成分、擬二元軸などを決める  
5. 計算→検証：既知の実験状態図・既報値と整合するかをまず確認する  
6. 設計へ使う：熱処理窓、析出相の回避、プロセス条件の探索へ接続する  

## まとめ
CALPHADは、自由エネルギーモデルとデータベースに基づき、多成分多相の相平衡を再現・外挿するための材料設計基盤である。MIでは、CALPHADを制約条件とデータ生成器として組み込み、探索の効率化と信頼性付与（不確かさの明示）に活用するのが有効である。