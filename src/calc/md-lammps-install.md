# LAMMPS のインストール方法

## 参考ドキュメント

- LAMMPS 公式サイト  
  - <https://www.lammps.org/>
- LAMMPS 公式ドキュメント（Install）  
  - <https://docs.lammps.org/Install.html>
- ソースコード（GitHub）  
  - <https://github.com/lammps/lammps>

---

## 概要

LAMMPS のインストールは、大きく分けて次の 3 パターンがあります。

1. **パッケージマネージャでインストール**（Ubuntu の `apt` など）
2. **ソースコードから自前ビルド**（CMake もしくは Make）
3. **スーパーコンピュータ・HPC クラスタのモジュールを利用**

それぞれにメリット・デメリットがあります。

- 手軽さを優先 → ① パッケージマネージャ
- 新しいバージョン・特定のパッケージを使いたい → ② 自前ビルド
- 研究室やセンターのクラスタ → ③ モジュール（管理者提供）を利用

以下では、それぞれのパターンを 「どういうときに」「何を準備して」「何を選ぶか」という視点で整理します。

---

## 1. パッケージマネージャによるインストール

### 1.1 特徴

- 例：Ubuntu の場合は `apt` 経由で LAMMPS をインストールできる場合がある。
- **利点**
  - 手軽・早い
  - 依存関係（MPI・FFT など）を勝手に解決してくれる
- **欠点**
  - バージョンが古いことがある
  - 有効化されている LAMMPS のパッケージが限られることが多い

### 1.2 向いているケース

- 「とりあえず LAMMPS を触ってみたい」
- 「単純な MD の練習用。最新機能や特殊なパッケージは不要」

### 1.3 確認すべき点

- インストールされる LAMMPS のバージョン
- 有効化されているパッケージ（`MANYBODY`, `KSPACE`, `USER-REAXC` など）
- MPI 版かシリアル版か

---

## 2. ソースコードからのビルド（自前コンパイル）

LAMMPS を本格的に利用する場合、多くの環境で自分でビルドすることになります。

### 2.1 全体像

1. LAMMPS のソースコードをダウンロード（公式サイト or GitHub）
2. コンパイラ／ライブラリを準備  
   （C/C++ コンパイラ、MPI、FFT、必要なら GPU 関連）
3. CMake もしくは Make を用いてビルド設定
4. ビルド（コンパイル）して実行ファイルを生成
5. 実行ファイルにパスを通し、簡単なテストを走らせる

### 2.2 前提として必要なもの

- コンパイラ
  - GCC 系（`gcc`, `g++`）や Intel oneAPI など
- MPI 実装
  - OpenMPI や MPICH など（並列計算をする場合）
- FFT ライブラリ
  - FFTW など（クーロン相互作用の計算で利用）
- 必要に応じて
  - GPU 用ライブラリ（CUDA, KOKKOS など）
  - 数値線形代数ライブラリ（MKL, OpenBLAS など）

> ポイント：  
> まず「C/C++ コンパイラと MPI がちゃんと使える状態になっているか」を確認してから LAMMPS に取りかかるとスムーズです。

### 2.3 CMake ビルドと Make ビルド

公式ドキュメントでは、CMake を使う方法が推奨されつつあります。

- CMake ベース
  - ビルドオプションの管理がわかりやすい
  - どのパッケージを有効にするかを GUI 的に整理しやすい
- 従来の Make ベース
  - 既存のノウハウやドキュメントが多い
  - Makefile を直接いじる柔軟性

いずれの方法でも、

- 有効にするパッケージ（`MANYBODY`, `KSPACE`, `MOLECULE`, `USER-*` など）
- 並列実行に使う MPI
- FFT・GPU などのバックエンド

を指定する、という流れは共通です。

### 2.4 有効化する LAMMPS パッケージの選び方

LAMMPS には多数のパッケージがあり、ビルド時に

- どの物理モデルを使いたいか
- どの相互作用ポテンシャルが必要か
- GPU を使うかどうか

などに応じて選択します。

例：

- 金属系のポテンシャル（EAM など） → `MANYBODY`
- 長距離クーロン相互作用 → `KSPACE`
- 高分子・分子系 → `MOLECULE`, `CLASS2` など  
- Reactive 系（ReaxFF） → `USER-REAXC`
- GPU や KOKKOS → `KOKKOS`, `GPU`

> 最初は「必要最小限」に絞ってビルドし、  
> 足りないものが出てきたら後からパッケージを追加して再ビルドする、という運用でもよいです。

### 2.5 ビルド後にやること（概念）

- 生成された実行ファイル（例：`lmp` や `lmp_mpi`）を
  - どこに置くか（ホーム以下の `bin` ディレクトリなど）
  - PATH にどう通すか
- `lmp -h` のようなヘルプを眺めて
  - 有効化されているパッケージを確認
- 公式の `examples` ディレクトリにある簡単な入力を走らせて
  - 正常に終了するか
  - 並列実行が問題なく動くか  
  を確認する

---

## 3. スーパーコンピュータ・HPC クラスタでの利用

### 3.1 モジュールシステムの利用

多くのスーパーコンピュータや研究機関のクラスタでは、

- `module load lammps`  
  のような形で、管理者が用意した LAMMPS を使うのが標準です。

この場合、

- インストール作業そのものは不要
- 代わりに、
  - 利用可能な LAMMPS のバージョン
  - 有効になっているパッケージ
  - 推奨される MPI の使い方（ジョブスクリプト）
  をローカルルール（マニュアルや Wiki）に従って確認します。

### 3.2 よく確認しておくべき項目

- 提供されている LAMMPS の ビルドオプション
  - どのパッケージが有効か
  - GPU 対応のビルドがあるか
- 利用すべき MPI 実装と `mpirun` / `srun` のルール
- ジョブスケジューラ（SLURM, PBS など）との連携方法
  - 例：`srun lmp …` のような書き方が推奨されているか

> 不明な点は、スパコンの利用マニュアル or 管理者に問い合わせるのが近道です。  
> 「LAMMPS を自分で入れる」前に、既に良いビルドが用意されていないか必ず確認するとよいです。

---

## 4. バージョン管理と複数ビルドの共存

研究用途では、

- 安定して動いている古いバージョン
- 新機能を試す新しいバージョン
- GPU 版・CPU 版 など

を環境ごとに使い分ける場面がよくあります。

### 4.1 ディレクトリ構成の例（考え方）

- `~/opt/lammps/stable/`  
  → 安定版ビルド
- `~/opt/lammps/latest/`  
  → 最新ソースからのビルド
- `~/opt/lammps/gpu/`  
  → GPU 対応ビルド

それぞれに

- 実行ファイル
- ビルド時に使ったオプションのメモ（テキスト）
- テストに使った入力デッキのサンプル

を置いておく。

### 4.2 PATH の切り替え方（概念）

- シェルの設定ファイル（`~/.bashrc` 等）で  
  「どの LAMMPS を優先するか」を制御するイメージです。
- 研究ごとに仮想環境やモジュールを切り替える運用もあり得ます。

---

## 5. インストール確認とトラブルシュート（考え方）

### 5.1 インストール確認の流れ（概念）

1. 実行ファイルが存在するかを確認
2. ヘルプメッセージでバージョンとパッケージを確認
3. 公式 examples の簡単な入力を
   - シリアル
   - MPI 並列  
   の両方で試す

### 5.2 よくあるトラブルのパターン

- **コンパイラやライブラリが見つからない**
  - CMake / Make のログに「ライブラリが見つからない」メッセージが出ていないか確認
- **MPI が使えない／落ちる**
  - MPI の実装が正しくロードされているか
  - LAMMPS ビルド時に同じ MPI を使っているか
- **特定のパッケージが使えない**
  - そもそもパッケージを有効にしてビルドしているか
  - 依存する外部ライブラリが正しくリンクされているか

---

## 6. まとめ

このページでは、LAMMPS のインストールについて

1. **インストールパターンの整理**
   - パッケージマネージャ
   - ソースからの自前ビルド
   - HPC モジュール
2. **自前ビルドに必要な前提**
   - コンパイラ・MPI・FFT などの準備
   - CMake / Make とパッケージ選択
3. **HPC クラスタでの利用時のポイント**
   - 既存モジュールの確認
   - バージョンとビルドオプションの把握
4. **複数バージョン・複数ビルドの共存**
   - ディレクトリ構成の工夫
   - PATH の切り替え
5. **インストール確認とトラブルシュートの考え方**
