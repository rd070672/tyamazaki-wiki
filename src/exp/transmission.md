# 伝達関数とシステム同定
計測で観測される波形は、対象そのものの信号 $x(t)$ ではなく、センサ・増幅器・ケーブル・フィルタ・機械構造などが作る線形系を通過した出力 $y(t)$ である。したがって「真の信号」を議論するには、装置全体の伝達関数 $H(\omega)$ を意識し、ゲインと位相の周波数依存、共振・反共振、時間応答と帯域の対応を同一の枠組みで扱う必要がある。

## 参考ドキュメント
1. Analog Devices, MT-003: Understand SINAD, ENOB, SNR, THD, THD+N, and SFDR（計測指標と周波数領域評価の基礎）  
   https://www.analog.com/media/en/training-seminars/tutorials/MT-003.pdf

2. Tektronix, Rise Time and Bandwidth Relationship（立ち上がり時間と帯域の関係）  
   https://www.tek.com/en/documents/primer/primer-rise-time-and-bandwidth

3. Keysight, Reflections and Terminations in Transmission Lines（反射係数と終端、伝送線路の基礎）  
   https://www.keysight.com/us/en/assets/7018-06804/technical-overviews/5989-7346.pdf


## 1. モデル化の出発点

## 1.1 入出力関係
装置全体を線形・時不変（LTI）系として近似できる範囲では、入力 $x(t)$ と出力 $y(t)$ は畳み込みで結ばれる。

$$
y(t)=(h*x)(t)=\int_{-\infty}^{\infty} h(\tau)\,x(t-\tau)\,d\tau
$$

周波数領域では

$$
Y(\omega)=H(\omega)X(\omega),\qquad H(\omega)=\mathcal{F}\{h(t)\}
$$

が成立する。計測とは、$x(t)$ を直接見るのではなく、$H(\omega)$ を掛けた結果を見ている行為である。

## 1.2 複素伝達関数とゲイン・位相
一般に $H(\omega)$ は複素数であり、

$$
H(\omega)=|H(\omega)|e^{j\phi(\omega)}
$$

と分解できる。$|H(\omega)|$ がゲイン周波数特性、$\phi(\omega)$ が位相周波数特性である。位相遅れは時間遅れに相当し、波形形状やピーク位置を変える。



## 2. 位相遅れと群遅延

## 2.1 位相と時間遅れ
純粋な時間遅れ $\tau$ は

$$
H(\omega)=e^{-j\omega\tau}
$$

で与えられ、ゲインは一定だが位相は周波数に比例して回転する。

## 2.2 群遅延
周波数成分ごとの到達時間の差は群遅延で表される。

$$
\tau_g(\omega)=-\frac{d\phi(\omega)}{d\omega}
$$

$\tau_g(\omega)$ が一定なら波形の形状は保たれやすいが、$\tau_g(\omega)$ が周波数で変化すると、パルスが歪む、立ち上がりが丸まる、リンギングが出るなどの形で現れる。



## 3. 共振・反共振の基本

## 3.1 共振
共振（resonance）は、ある周波数で系がエネルギーを蓄えやすくなり、ゲインが局所的に増大する現象である。機械構造（治具、プローブ、支持、配線の振動）、電気回路（RLC）、磁気系（磁化ダイナミクス）などが共振源になる。

単一の2次系（質量–ばね–ダンパ、あるいはRLC）として

$$
H(s)=\frac{\omega_0^2}{s^2+2\zeta\omega_0 s+\omega_0^2}
$$

を考えると、減衰比 $\zeta$ が小さいほど共振ピークが鋭く、$Q$（品質係数）が高い。$Q$ と $\zeta$ は

$$
Q=\frac{1}{2\zeta}
$$

で関係づけられる（標準形の2次系）。

共振近傍では位相も急に回転し、群遅延が大きくなるため、時間波形にはリンギングとして現れやすい。

## 3.2 反共振
反共振（antiresonance）は、ある周波数で応答が局所的に落ち込む（ノッチが現れる）現象である。多自由度系の干渉（異なる経路の合成が打ち消し合う）、機械–電気の結合、測定点の位置（節）などで発生する。

重要なのは、反共振が「入力が小さい」ことを意味しない点である。系内部のエネルギーはむしろ大きいこともあり、測定点が節に近い、あるいは合成が打ち消した結果として観測が小さいだけの場合がある。したがって反共振は、系の内部状態や結合構造を示す署名として扱うべきである。

## 3.3 零点と極としての理解
多くの線形系は有理関数で近似でき、

$$
H(s)=K\frac{\prod_{m}(s-z_m)}{\prod_{n}(s-p_n)}
$$

と表せる。共振は極 $p_n$ が虚軸近傍に来ることで生じ、反共振は零点 $z_m$ が同様に効くことでノッチを作る。ボード線図の形（ピーク／ノッチ）と位相回転は、極と零点の配置で体系的に説明できる。



## 4. 立ち上がり時間と帯域の関係

## 4.1 1次低域系のステップ応答
1次低域系

$$
H(s)=\frac{1}{1+s\tau}
$$

のステップ応答は

$$
y(t)=1-e^{-t/\tau}
$$

であり、時間定数 $\tau$ が立ち上がりを決める。カットオフ周波数 $f_c$ は

$$
f_c=\frac{1}{2\pi\tau}
$$

である。

10%→90% 立ち上がり時間 $t_r$ は

$$
t_r=\tau\ln\left(\frac{0.9}{0.1}\right)=\tau\ln 9\approx 2.197\tau
$$

より、

$$
t_r\approx \frac{0.35}{f_c}
$$

が得られる。この関係は計測で頻出する。立ち上がりが遅いのは「信号が遅い」だけでなく「装置が帯域制限している」可能性がある。

## 4.2 計測系の合成
オシロスコープやアンプ、プローブなど複数の1次要素が直列に並ぶと、帯域はさらに狭くなり、立ち上がりは遅くなる。近似として、ガウス的な帯域制限が支配する場合は

$$
t_{r,\mathrm{total}}\approx \sqrt{t_{r1}^2+t_{r2}^2+\cdots}
$$

が経験的に用いられる。いずれにせよ、立ち上がり時間から帯域を推定するには、対象と装置の寄与を分離する必要がある。



## 5. センサ・増幅器・ケーブルが作る $H(\omega)$ の具体像

## 5.1 センサ
センサは感度（ゲイン）だけでなく、機械共振（加速度計など）、熱時定数（温度センサ）、磁気緩和（磁気センサ）などを含む周波数特性を持つ。センサの校正表は、実質的に $H(\omega)$ の一部である。

## 5.2 増幅器・フィルタ
増幅器は有限帯域と位相回転を持ち、また入力・出力インピーダンスの有限性がケーブルや負荷と結合して極・零点を作る。フィルタは目的の帯域制限を担うが、位相・群遅延を通じて波形歪みも作る。

## 5.3 ケーブルと終端
ケーブルは分布定数系であり、高周波では伝送線路として扱う必要がある。特性インピーダンス $Z_0$ の線路を負荷 $Z_L$ で終端すると反射係数は

$$
\Gamma=\frac{Z_L-Z_0}{Z_L+Z_0}
$$

で与えられる。$\Gamma\neq 0$ なら反射が生じ、周波数応答にリップルやノッチが現れ、時間波形には反射遅れの段差として現れる。これはしばしば共振・反共振に似た形で観測される。



## 6. 装置で歪められた信号としての観測

## 6.1 観測信号の構造
計測で得る $y(t)$ は、理想的には

$$
y(t)=(h*x)(t)+n(t)
$$

であり、$n(t)$ は雑音である。波形の変形は $h(t)$ によるもので、雑音増加とは別問題である。したがって、見えたピークの鋭さ、立ち上がり、位相遅れを対象固有と誤認しないために、$H(\omega)$ を同定する視点が必要になる。

## 6.2 波形歪みの代表例
- 立ち上がりが丸い  
  帯域制限（低域系）で高周波成分が削られている。
- リンギングが乗る  
  2次以上の共振が効いている、あるいは反射がある。
- 周波数で位相が強く回る  
  群遅延が大きく、パルスの形が保たれない。
- 特定周波数だけ落ちる  
  反共振（零点）やノッチフィルタ、結合の打ち消しが起きている。



## 7. システム同定の考え方

## 7.1 周波数応答からの同定
既知入力 $x(t)$ を与え、出力 $y(t)$ を測り、フーリエ領域で

$$
\hat{H}(\omega)=\frac{Y(\omega)}{X(\omega)}
$$

を推定する。測定雑音がある場合は、スペクトル密度を用いて

$$
\hat{H}(\omega)=\frac{S_{yx}(\omega)}{S_{xx}(\omega)}
$$

がよく用いられる。ここで $S_{xx}$ は入力の自己スペクトル、$S_{yx}$ は入出力の相互スペクトルである。

整合性確認にはコヒーレンス

$$
\gamma^2(\omega)=\frac{|S_{yx}(\omega)|^2}{S_{xx}(\omega)S_{yy}(\omega)}
$$

が有効であり、$\gamma^2(\omega)\approx 1$ なら LTI 近似が良く成り立っていると判断しやすい。

## 7.2 時間応答からの同定
インパルス応答 $h(t)$ を直接測るのは難しいため、ステップ応答（立ち上がり）や、パルス応答から $h(t)$ を推定する。1次系なら $\tau$、2次系なら $\omega_0,\zeta$ が時間波形に強く現れる。

## 7.3 物理パラメータへの落とし込み
電気回路なら RLC、機械なら $m$–$c$–$k$ の形に同定し、共振周波数や減衰を物理量として解釈する。純粋なフィッティングに留めず、どの構成要素が極・零点を作っているかに戻すと、設計変更（ケーブル、終端、固定、材質）と直結する。



## 8. 測定設計としての要点（装置をフィルタとして扱う）

- 対象の周波数成分を先に定義し、その上で装置の $|H(\omega)|$ と $\phi(\omega)$ が許容範囲か確認する
- 波形形状が重要なら、群遅延の平坦性を重視し、急峻フィルタや高Q共振の影響を評価する
- 共振・反共振・反射は、周波数領域ではピーク／ノッチ、時間領域ではリンギング／段差として現れるため、両方の表現で相互検証する
- 装置の $H(\omega)$ が既知なら、逆フィルタで補正できる場合があるが、ノッチ（零点）や雑音増幅の問題があるため、補正の前に物理的な原因除去（終端、固定、配線）を優先する



## まとめと展望
計測系は感度の集合ではなく、周波数依存のゲインと位相を持つ伝達関数 $H(\omega)$ の連鎖である。共振・反共振・帯域制限・反射は、周波数領域と時間領域の両方で同じ現象の別表現として現れるため、両者を往復しながら装置の寄与を分離することが本質である。

今後は、測定対象の時間スケールが短くなるほど、群遅延・反射・クロック由来の誤差が支配的になる。したがって、装置をフィルタとして定量し、必要なら同定により $H(\omega)$ を実測して補正可能性と限界（零点や雑音増幅）を評価する姿勢が、精密計測の再現性を決めると考えられるのである。



## その他参考にしたsources
- Stanford Research Systems, Lock-in Amplifier Basics（位相・周波数応答と同定の直観に関する資料）  
  https://www.thinksrs.com/downloads/pdfs/applicationnotes/AboutLIAs.pdf

- National Instruments, Frequency Response Function (FRF) and Coherence（$S_{yx}/S_{xx}$、コヒーレンスの定義）  
  https://www.ni.com/en/support/documentation/supplemental/18/coherence-function-and-frequency-response-function.html

- JIS/IEC 計測一般（DAQ・オシロの時間軸精度、帯域、測定不確かさの考え方に関連する規格群）
